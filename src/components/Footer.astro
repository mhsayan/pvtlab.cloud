---
import type { HTMLAttributes } from "astro/types";
import { SOCIALS } from "@/constants";
import { SITE } from "@/config";
import IconArrowUp from "@/assets/icons/IconArrowNarrowUp.svg";

const currentYear = new Date().getFullYear();

type Props = {
  noMarginTop?: boolean;
} & HTMLAttributes<"footer">;

const { noMarginTop = false, class: className, ...attrs } = Astro.props;
---

<footer
  class:list={["app-layout", { "mt-auto": !noMarginTop }, className]}
  {...attrs}
>
  <!-- Subtle top border -->
  <div class="footer-border"></div>

  <div class="footer-main">
    <!-- Brand & Copyright -->
    <div class="footer-brand">
      <a href="/" class="site-logo site-logo-sm">
        <span class="site-logo-icon">
          <span class="site-logo-monogram">P</span>
        </span>
        <span class="site-logo-text">
          <span class="site-logo-name">pvtlab</span>
          <span class="site-logo-dot"></span>
          <span class="site-logo-domain">cloud</span>
        </span>
      </a>
      <span class="footer-copyright">&copy; {currentYear}</span>
    </div>

    <!-- Navigation -->
    <nav class="footer-nav">
      <a href="/posts">Posts</a>
      <a href="/about">About</a>
      <button type="button" class="footer-search-btn" id="footer-search-btn">Search</button>
      {SITE.showArchives && <a href="/archives">Archives</a>}
      <a href="/rss.xml" target="_blank">RSS</a>
    </nav>

    <!-- Socials + Back to top -->
    <div class="footer-right">
      {
        SOCIALS.length > 0 && (
          <div class="footer-socials">
            {SOCIALS.map(social => (
              <a
                href={social.href}
                target="_blank"
                rel="noopener noreferrer"
                class="footer-social-link"
                title={social.linkTitle}
              >
                <social.icon class="size-5 stroke-current stroke-2" />
              </a>
            ))}
          </div>
        )
      }
      <button id="back-to-top" class="back-to-top" title="Back to top" aria-label="Back to top">
        <IconArrowUp class="size-5 stroke-current stroke-2" />
      </button>
    </div>
  </div>
</footer>

<script>
  function setupBackToTop() {
    const btn = document.getElementById("back-to-top");
    if (!btn) return;

    btn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  }

  function setupFooterSearch() {
    const btn = document.getElementById("footer-search-btn");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const openSearchModal = (window as { openSearchModal?: () => void }).openSearchModal;
      if (openSearchModal) {
        openSearchModal();
      }
    });
  }

  setupBackToTop();
  setupFooterSearch();
  document.addEventListener("astro:after-swap", () => {
    setupBackToTop();
    setupFooterSearch();
  });
</script>

<style>
  .footer-border {
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      color-mix(in srgb, var(--accent) 25%, transparent) 50%,
      transparent 100%
    );
  }

  .footer-main {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    padding: 5rem 0 4rem;
  }

  @media (min-width: 640px) {
    .footer-main {
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding: 6rem 0 5rem;
    }
  }

  .footer-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .footer-copyright {
    font-size: 0.8125rem;
    color: color-mix(in srgb, var(--foreground) var(--text-muted-light), transparent);
  }

  .footer-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 1.25rem;
  }

  .footer-nav a {
    font-size: 0.875rem;
    color: color-mix(in srgb, var(--foreground) var(--text-muted-medium), transparent);
    transition: color var(--duration-normal);
  }

  .footer-nav a:hover,
  .footer-nav button:hover {
    color: var(--accent);
  }

  .footer-search-btn {
    font-size: 0.875rem;
    color: color-mix(in srgb, var(--foreground) var(--text-muted-medium), transparent);
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: color var(--duration-normal);
  }

  .footer-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .footer-socials {
    display: flex;
    gap: 0.5rem;
  }

  .footer-social-link {
    color: color-mix(in srgb, var(--foreground) var(--text-muted-medium), transparent);
    transition: color var(--duration-normal);
  }

  .footer-social-link:hover {
    color: var(--accent);
  }

  .back-to-top {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    border: 1px solid var(--border);
    color: color-mix(in srgb, var(--foreground) var(--text-muted-medium), transparent);
    background: transparent;
    transition: all var(--duration-normal);
  }

  .back-to-top:hover {
    color: var(--accent);
    border-color: var(--accent);
    transform: translateY(-2px);
  }
</style>
