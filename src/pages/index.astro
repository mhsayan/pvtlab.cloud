---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <!-- Full-Screen Hero Section -->
    <section id="hero" class="hero-section">
      <!-- Animated Background -->
      <div class="hero-bg">
        <div class="hero-blob hero-blob-1"></div>
        <div class="hero-blob hero-blob-2"></div>
        <div class="hero-blob hero-blob-3"></div>
        <div class="hero-grid"></div>
      </div>

      <!-- Hero Content -->
      <div class="hero-content app-layout">
        <!-- Status Badge -->
        <div class="hero-fade-in" style="--delay: 0s">
          <span class="status-badge">
            <span class="status-dot">
              <span class="status-ping"></span>
              <span class="status-core"></span>
            </span>
            Available for opportunities
          </span>
        </div>

        <!-- Main Heading -->
        <div class="hero-fade-in" style="--delay: 0.1s">
          <h1 class="hero-title">
            <span class="hero-title-line">Hi, I'm</span>
            <span class="hero-title-name">Sayan</span>
          </h1>
        </div>

        <!-- Role/Subtitle -->
        <div class="hero-fade-in" style="--delay: 0.2s">
          <p class="hero-subtitle">
            <span class="typing-text">Developer & Creative Thinker</span>
          </p>
        </div>

        <!-- Description -->
        <div class="hero-fade-in" style="--delay: 0.3s">
          <p class="hero-description">
            Welcome to my personal blog and digital space. Here I share my thoughts,
            ideas, and things I learn along the way.
          </p>
        </div>

        <!-- CTA Buttons -->
        <div class="hero-fade-in hero-actions" style="--delay: 0.4s">
          <a href="/posts" class="btn-primary group">
            Read Blog
            <IconArrowRight class="size-4 group-hover:translate-x-1 transition-transform" />
          </a>
          <a href="/about" class="btn-secondary">
            About Me
          </a>
        </div>

        <!-- Social Links -->
        {
          SOCIALS.length > 0 && (
            <div class="hero-fade-in hero-socials" style="--delay: 0.5s">
              <p class="hero-socials-label">Find me on</p>
              <div class="hero-socials-list">
                {SOCIALS.map(social => (
                  <a
                    href={social.href}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="social-btn group"
                    title={social.linkTitle}
                  >
                    <social.icon class="size-5 stroke-current stroke-[1.5] group-hover:stroke-accent group-hover:scale-110 transition-all duration-300" />
                    <span class="sr-only">{social.linkTitle}</span>
                  </a>
                ))}
                <a
                  href="/rss.xml"
                  target="_blank"
                  class="social-btn group"
                  aria-label="RSS Feed"
                  title="RSS Feed"
                >
                  <IconRss class="size-5 stroke-current stroke-[1.5] group-hover:stroke-accent group-hover:scale-110 transition-all duration-300" />
                  <span class="sr-only">RSS Feed</span>
                </a>
              </div>
            </div>
          )
        }
      </div>

      <!-- Scroll indicator -->
      <div class="scroll-indicator hero-fade-in" style="--delay: 0.7s">
        <div class="scroll-mouse">
          <div class="scroll-wheel"></div>
        </div>
      </div>
    </section>

    <!-- Posts Sections - seamless continuation -->
    <div class="app-layout posts-section">
      {
        featuredPosts.length > 0 && (
          <section id="featured" class="pb-12">
            <h2 class="font-semibold tracking-wide mb-2">Featured</h2>
            <p class="text-foreground/50 text-sm mb-6">Hand-picked posts worth reading</p>
            <ul class="space-y-4">
              {featuredPosts.map(data => (
                <Card variant="h3" {...data} />
              ))}
            </ul>
          </section>
        )
      }

      {
        recentPosts.length > 0 && (
          <section id="recent-posts" class="pb-12">
            <h2 class="font-semibold tracking-wide mb-2">Recent Posts</h2>
            <p class="text-foreground/50 text-sm mb-6">Latest thoughts and updates</p>
            <ul class="space-y-4">
              {recentPosts.map(
                (data, index) =>
                  index < SITE.postPerIndex && <Card variant="h3" {...data} />
              )}
            </ul>
          </section>
        )
      }

      <div class="pb-16 text-center">
        <LinkButton
          href="/posts/"
          class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-accent text-white font-medium hover:bg-accent/90 transition-all duration-200 hover:shadow-lg hover:shadow-accent/25"
        >
          View All Posts
          <IconArrowRight class="inline-block size-4 rtl:-rotate-180" />
        </LinkButton>
      </div>
    </div>
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
